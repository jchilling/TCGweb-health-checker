# TCG Website Health Checker

[![Python](https://img.shields.io/badge/Python-3.8+-blue.svg)](https://www.python.org/downloads/)

ä¸€å€‹å°ˆæ¥­çš„æ”¿åºœç¶²ç«™å¥åº·åº¦æª¢æ¸¬å·¥å…·ï¼Œæä¾›å…¨é¢çš„ç¶²ç«™å…§å®¹æ›´æ–°æ™‚é–“æ–°èˆŠç¨‹åº¦åˆ†æã€å…§å¤–éƒ¨é€£çµæœ‰æ•ˆæ€§æª¢æŸ¥ã€‚

> ğŸ’¼ æœ¬å°ˆæ¡ˆæ–¼è‡ºåŒ—å¸‚æ”¿åºœè³‡è¨Šå±€æœæ›¿ä»£å½¹æœŸé–“é–‹ç™¼

## âœ¨ ä¸»è¦åŠŸèƒ½

- ğŸ•·ï¸ **æ™ºèƒ½æ·±åº¦çˆ¬èŸ²**ï¼šè‡ªå‹•ç™¼ç¾ sitemap ä¿ç•™åŸå§‹ç¶²ç«™çµæ§‹ï¼Œæ”¯æ´å¤šå±¤ç´šç¶²ç«™çˆ¬å–
- ğŸ“… **æ™ºèƒ½æ—¥æœŸè­˜åˆ¥**ï¼šæ”¯æ´æ°‘åœ‹å¹´ã€ä¸­è‹±æ—¥æœŸç­‰å¤šç¨®æ ¼å¼
- ğŸ”— **é€£çµæœ‰æ•ˆæ€§æª¢æŸ¥**ï¼šæª¢æ¸¬å…§éƒ¨é é¢å’Œå¤–éƒ¨é€£çµç‹€æ…‹
- ğŸ“Š **å°ˆæ¥­å ±å‘Šç”Ÿæˆ**ï¼šè¼¸å‡º JSON æ‘˜è¦å’Œè©³ç´° Excel çµ±è¨ˆå ±å‘Š
- ğŸš€ **é«˜æ•ˆèƒ½è™•ç†**ï¼šæ”¯æ´å¤šé€²ç¨‹ä¸¦è¡Œè™•ç†å’Œè¨˜æ†¶é«”è‡ªå‹•ç®¡ç†
- ğŸ¯ **é‡è¤‡æª¢æ¸¬**ï¼šè‡ªå‹•è·³éé‡è¤‡é é¢å’Œåˆ†é åˆ—è¡¨
- ğŸ“§ **è‡ªå‹•éƒµå¯„å ±å‘Š**ï¼šå®Œæˆå¾Œè‡ªå‹•æ‰“åŒ…ä¸¦ç™¼é€çµæœ
- â˜ï¸ **é›²ç«¯éƒ¨ç½²æ”¯æ´**ï¼šæ”¯æ´ GCP è‡ªå‹•åŒ–éƒ¨ç½²èˆ‡é—œæ©Ÿ

## ğŸš€ å¿«é€Ÿé–‹å§‹

### å®‰è£ä¾è³´

```bash
# å…‹éš†å°ˆæ¡ˆ
git clone https://github.com/dayoxiao/TCGweb-health-checker.git
cd TCGweb-health-checker

# å®‰è£ Python ä¾è³´
pip install -r requirements.txt

# å®‰è£ Playwright ç€è¦½å™¨
playwright install chromium
```

### è¨­å®šç¶²ç«™æ¸…å–®

ç·¨è¼¯ `config/websites.csv` æª”æ¡ˆï¼Œæ”¯æ´é€²éšé…ç½®ï¼š

```csv
URL,name,depth,save_html,pagination
https://example.com,ç¯„ä¾‹ç¶²ç«™,,,
https://another-site.com,å¦ä¸€å€‹ç¶²ç«™,2,TRUE,FALSE
https://special-site.org,ç‰¹æ®Šç¶²ç«™,1,FALSE,TRUE
```

**æ¬„ä½èªªæ˜ï¼š**
- `URL`: ç¶²ç«™çš„å®Œæ•´ç¶²å€ï¼ˆå¿…è¦ï¼‰
- `name`: ç¶²ç«™çš„åç¨±ï¼ˆé¸æ“‡æ€§ï¼Œç”¨æ–¼å»ºç«‹è³‡æ–™å¤¾åç¨±ï¼‰
- `depth`: è©²ç¶²ç«™çš„çˆ¬å–æ·±åº¦ï¼ˆé¸æ“‡æ€§ï¼Œç©ºç™½ä½¿ç”¨å…¨åŸŸè¨­å®šï¼‰
- `save_html`: æ˜¯å¦å„²å­˜HTMLæª”æ¡ˆï¼ˆTRUE/FALSEï¼Œç©ºç™½ä½¿ç”¨å…¨åŸŸè¨­å®šï¼‰
- `pagination`: æ˜¯å¦å•Ÿç”¨åˆ†é çˆ¬å–ï¼ˆTRUE/FALSEï¼Œç©ºç™½ä½¿ç”¨å…¨åŸŸè¨­å®šï¼‰

## ğŸ“‹ ä½¿ç”¨åƒæ•¸

| åƒæ•¸ | èªªæ˜ | é è¨­å€¼ |
|------|------|--------|
| `--depth` | çˆ¬èŸ²æœ€å¤§æ·±åº¦ | 2 |
| `--config` | ç¶²ç«™è¨­å®šæª”è·¯å¾‘ | `config/websites.csv` |
| `--concurrent` | ä¸¦è¡Œè™•ç†æ•¸é‡ | 2 |
| `--no-save-html` | ä¸å„²å­˜ HTML æª”æ¡ˆï¼ˆæå‡æ•ˆèƒ½ï¼‰ | False |
| `--no-pagination` | ç¦ç”¨åˆ†é çˆ¬å– | False |
| `--max-mem-mb` | subprocessè¨˜æ†¶é«”ä¸Šé™ (MB) | 1024 |

### åŸ·è¡Œæª¢æ¸¬

```bash
# æœ¬åœ°åŸ·è¡ŒåŸºæœ¬æª¢æ¸¬ï¼ˆé è¨­æ·±åº¦2å±¤ã€å­˜htmlã€é‡åˆ°åˆ†é åˆ—è¡¨æœƒè‡ªå‹•å¾€ä¸‹çˆ¬ï¼‰
python main.py

# å¿«é€Ÿæª¢æ¸¬ï¼ˆåƒ…é¦–é å’Œ sitemap å¾€ä¸‹ä¸€å±¤ï¼‰
python main.py --depth 1 --concurrent 2 --no-save-html --no-pagination

# é€šç”¨å¤§è¦æ¨¡æª¢æ¸¬ï¼ˆå¾€ä¸‹ä¸‰å±¤ï¼Œä¸å­˜htmlåªçˆ¬æ²’æœ‰åˆ†é åƒæ•¸çš„åˆ—è¡¨ç¬¬ä¸€é ï¼‰
python main.py --depth 3 --concurrent 2 --no-save-html --no-pagination

# é›²ç«¯åŸ·è¡Œç‰ˆæœ¬ï¼ˆæœ‰è‡ªå‹•é—œæ©Ÿgcp vmå…§å®¹ï¼‰
python gcp_main_mpfast.py          # poolç®¡ç†çš„ç°¡å–®æ¨¡å¼ (æ¯çˆ¬å®Œä¸€å€‹ç¶²ç«™é‡å•Ÿä¸€å€‹æ–°çš„subprocess)
python gcp_main_mpselfqueue.py     # è‡ªç®¡ç†æ¨¡å¼ (æŒ‰max-mem-mbç›£æ¸¬æ¯ä¸€å€‹subprocessï¼Œè¶…éé‡å•Ÿ)
```

## ğŸ“Š è¼¸å‡ºå ±å‘Š

### 1. Excel çµ±è¨ˆå ±å‘Š
ä½ç½®ï¼š`output/website_summary_report_YYYY-MM.xlsx`

åŒ…å«ä»¥ä¸‹çµ±è¨ˆè³‡è¨Šï¼š
- ç¶²ç«™åŸºæœ¬è³‡è¨Šï¼ˆåç¨±ã€URLï¼‰
- é é¢çµ±è¨ˆï¼ˆç¸½æ•¸ã€æœ€å¾Œæ›´æ–°æ—¥æœŸ...ï¼‰
- å…§å®¹æ™‚æ•ˆæ€§ï¼ˆä¸€å¹´å‰å…§å®¹æ•¸é‡å’Œæ¯”ä¾‹ï¼‰
- é€£çµç‹€æ…‹ï¼ˆå¤±æ•ˆå…§éƒ¨é é¢ã€å¤±æ•ˆå¤–éƒ¨é€£çµæ•¸...ï¼‰
- åŸ·è¡Œè³‡è¨Šï¼ˆçˆ¬å–è€—æ™‚ã€çˆ¬å–æ—¥æœŸï¼‰

### 2. è©³ç´°é é¢æ‘˜è¦æª”æ¡ˆ
ä½ç½®ï¼š`assets/{ç¶²ç«™åç¨±}/page_summary.json`

```json
{
  "page_summary": {
    "https://example.com/": {
      "title": "ç¯„ä¾‹ç¶²ç«™é¦–é ",
      "last_updated": "2024-09-24",
      "filepath": "[æœªå„²å­˜] ç¯„ä¾‹ç¶²ç«™é¦–é .html",
      "status": 200,
      "depth": 0,
      "source_page": null
    },
    "https://example.com/about": {
      "title": "é—œæ–¼æˆ‘å€‘",
      "last_updated": "2024-08-15",
      "filepath": "[æœªå„²å­˜] é—œæ–¼æˆ‘å€‘.html",
      "status": 200,
      "depth": 1,
      "source_page": {
        "title": "ç¯„ä¾‹ç¶²ç«™é¦–é ",
        "url": "https://example.com/"
      }
    }
  },
  "external_links": {
    "https://external-site.com": {
      "status": 200,
      "source_page": {
        "title": "é—œæ–¼æˆ‘å€‘",
        "url": "https://example.com/about"
      }
    }
  }
}
```

### 3. éŒ¯èª¤é€£çµå ±å‘Š
è‡ªå‹•ç”Ÿæˆï¼š
- `error_pages.csv` - å¤±æ•ˆå…§éƒ¨é é¢
- `error_external_links.csv` - å¤±æ•ˆå¤–éƒ¨é€£çµ

## ğŸ—ï¸ ç³»çµ±æ¶æ§‹

```
â”œâ”€â”€ main.py                    # æœ¬åœ°åŸ·è¡Œä¸»ç¨‹å¼
â”œâ”€â”€ gcp_main_*.py              # é›²ç«¯éƒ¨ç½²ç‰ˆæœ¬
â”œâ”€â”€ crawler/
â”‚   â””â”€â”€ web_crawler.py         # ç¶²ç«™çˆ¬èŸ²å¼•æ“
â”œâ”€â”€ analyzer/
â”‚   â””â”€â”€ date_extraction.py     # æ™ºèƒ½æ—¥æœŸè­˜åˆ¥
â”œâ”€â”€ reporter/
â”‚   â””â”€â”€ report_generation*.py  # å ±å‘Šç”Ÿæˆç³»çµ±
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ extract_problematic_links.py  # éŒ¯èª¤é€£çµæå–
â”‚   â”œâ”€â”€ log_writer.py          # æ—¥èªŒè¨˜éŒ„å·¥å…·
â”‚   â””â”€â”€ email_reporter.py      # è‡ªå‹•éƒµå¯„åŠŸèƒ½
â”œâ”€â”€ config/
â”‚   â””â”€â”€ websites.csv           # ç¶²ç«™è¨­å®šæª”
â”œâ”€â”€ assets/                    # çˆ¬å–è³‡æ–™å„²å­˜
â””â”€â”€ output/                    # å ±å‘Šè¼¸å‡º
```

### ç³»çµ±éœ€æ±‚

- Python 3.8+
- å……è¶³çš„ç£ç¢Ÿç©ºé–“ï¼ˆè‡³å°‘20MBï¼‰
- ç©©å®šçš„ç¶²è·¯é€£ç·š
- è¨˜æ†¶é«”ï¼šå»ºè­°æ¯å€‹processé ç•™ 4GB ä»¥ä¸Šç©ºé–“ä¾›åŸ·è¡Œ

## â˜ï¸ é›²ç«¯éƒ¨ç½²

æ”¯æ´ Google Cloud Platform è‡ªå‹•åŒ–éƒ¨ç½²ï¼š

```bash
# è¨­å®šç’°å¢ƒ
bash setup-environment.sh

# å•Ÿå‹•é›²ç«¯åŸ·è¡Œï¼ˆå«è‡ªå‹•é—œæ©Ÿï¼‰
bash run-crawler-fast.sh      # ç°¡å–®æ¨¡å¼
bash run-crawler-selfqueue.sh # è‡ªç®¡ç†æ¨¡å¼
```

å®Œå…¨è‡ªå‹•åŒ–éƒ¨ç½²å¯ä½¿ç”¨ startup script æ”¾ç½®åœ¨ vm é–‹æ©ŸæŒ‡ä»¤ï¼š
- `startup-script-fast.sh` / `startup-script-selfqueue.sh`
- VM å•Ÿå‹•æ™‚è‡ªå‹•èª¿ç”¨ä¸Šè¿°è…³æœ¬åŸ·è¡Œç’°å¢ƒå®‰è£ â†’ ç¨‹å¼åŸ·è¡Œ â†’ é—œæ©Ÿ

## ğŸ“‹ å°ˆæ¡ˆè³‡è¨Š

- **ç‰ˆæœ¬**: 1.1.0
- **æœ€å¾Œæ›´æ–°**: 2025å¹´
- **ç¶­è­·è€…**: dayoxiao

â­ å¦‚æœé€™å€‹å°ˆæ¡ˆå°ä½ æœ‰å¹«åŠ©ï¼Œè«‹çµ¦å€‹æ˜Ÿæ˜Ÿæ”¯æŒä¸€ä¸‹ï¼
